{% extends "base.html" %}

{% block content %}
<div class="account-container">
    <!-- Mobile Header -->
    <div class="mobile-account-header">
        <h1>Ø­Ø³Ø§Ø¨ÙŠ</h1>
        <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
            <i class="fas fa-bars"></i>
        </button>
    </div>

    <div class="account-content-wrapper">
        <!-- Sidebar -->
        <div class="account-sidebar" id="accountSidebar">
            <div class="account-profile-card">
                <div class="account-avatar">
                    <img src="{{ url_for('static', filename='images/default-avatar.jpg') }}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ">
                    <div class="online-status {{ 'online' if True else 'offline' }}"></div>
                </div>
                <div class="account-info">
                    <h3>{{ user.username }}</h3>
                    <p class="account-type-badge {{ 'developer' if user.is_developer() else 'user' }}">
                        {{ "Ù…Ø·ÙˆØ±" if user.is_developer() else "Ù…Ø³ØªØ®Ø¯Ù…" }}
                    </p>
                    <p class="account-email">{{ user.email }}</p>
                </div>
            </div>

            <nav class="account-menu">
                <a href="#profile" class="menu-item active" onclick="showSection('profile')">
                    <i class="fas fa-user"></i>
                    <span>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</span>
                </a>
                
                {% if user.is_developer() %}
                <a class="menu-item" target="_blank" href="{{ url_for('developer_profile', dev_id=user.id) }}">
                    <i class="fas fa-file-alt"></i>
                    <span>Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©</span>
                </a>
                <a href="#my-games" class="menu-item" onclick="showSection('my-games')">
                    <i class="fas fa-gamepad"></i>
                    <span>Ø£Ù„Ø¹Ø§Ø¨ÙŠ</span>
                </a>
                <a href="{{ url_for('upload') }}" class="menu-item">
                    <i class="fas fa-upload"></i>
                    <span>Ø±ÙØ¹ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                </a>
                {% endif %}
                
                <a href="#security" class="menu-item" onclick="showSection('security')">
                    <i class="fas fa-shield-alt"></i>
                    <span>Ø§Ù„Ø£Ù…Ø§Ù†</span>
                </a>
                
                <a href="#settings" class="menu-item" onclick="showSection('settings')">
                    <i class="fas fa-cog"></i>
                    <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
                </a>
                
                <a href="{{ url_for('logout') }}" class="menu-item logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="account-main-content">
        <!-- Profile Section -->
        <div id="profile" class="content-section active">
            <div class="section-header">
                <h2><i class="fas fa-user"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h2>
                <button class="btn btn-edit" onclick="toggleEdit('profile')">ØªØ¹Ø¯ÙŠÙ„</button>
            </div>

            <form action="{{ url_for('update_username') }}" method="POST" id="username-form" style="display: none;">
                <div class="profile-info">
                    <div class="info-item">
                        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
                        <span id="username-display">{{ user.username }}</span>
                        <input type="text" id="username-edit" name="new_username" value="{{ user.username }}" 
                            class="edit-field" minlength="3" maxlength="20" 
                            pattern="[a-zA-Z0-9_]+" title="Ø£Ø­Ø±Ù Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ£Ø±Ù‚Ø§Ù… ÙˆØ´Ø±Ø·Ø© Ø³ÙÙ„ÙŠØ© (_) ÙÙ‚Ø·"
                            style="display: none;">
                    </div>
                    
                    <div class="info-item">
                        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
                        <span>{{ user.email }}</span>
                    </div>
                    
                    <div class="info-item">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨:</label>
                        <span class="account-type {{ 'developer' if user.is_developer() else 'user' }}">
                            {{ "Ù…Ø·ÙˆØ± Ø£Ù„Ø¹Ø§Ø¨" if user.is_developer() else "Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ" }}
                        </span>
                    </div>
                    
                    <div class="info-item">
                        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:</label>
                        <span>
                            {% if user.created_at %}
                                {{ user.created_at | format_date }}
                            {% else %}
                                ØºÙŠØ± Ù…ØªÙˆÙØ±
                            {% endif %}
                        </span>
                    </div>
                </div>

                <div class="edit-buttons" id="profile-edit-buttons" style="display: none;">
                    <button type="submit" class="btn btn-primary">Ø­ÙØ¸</button>
                    <button type="button" class="btn btn-secondary" onclick="cancelEdit('profile')">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </form>

            <div id="profile-display" style="display: block;">
                <div class="profile-info">
                    <div class="info-item">
                        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
                        <span>{{ user.username }}</span>
                    </div>
                    
                    <div class="info-item">
                        <label> Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
                        <span>{{ user.email }}</span>
                    </div>
                    
                    <div class="info-item">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨:</label>
                        <span class="account-type {{ 'developer' if user.is_developer() else 'user' }}">
                            {{ "Ù…Ø·ÙˆØ± Ø£Ù„Ø¹Ø§Ø¨" if user.is_developer() else "Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ" }}
                        </span>
                    </div>
                    
                    <div class="info-item">
                        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:</label>
                        <span>
                            {% if user.created_at %}
                                {{ user.created_at | format_date }}
                            {% else %}
                                ØºÙŠØ± Ù…ØªÙˆÙØ±
                            {% endif %}
                        </span>
                    </div>
                </div>
            </div>
        </div>

            <!-- Security Section -->
            <div id="security" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-shield-alt"></i> Ø§Ù„Ø£Ù…Ø§Ù†</h2>
                </div>

                <div class="security-content">
                    <!-- Change Password -->
                    <div class="security-card">
                        <h3>ğŸ”’ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
                        <form class="security-form" action="{{ url_for('change_password') }}" method="POST">
                            <div class="form-group">
                                <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</label>
                                <div class="password-wrapper">
                                    <input type="password" name="current_password" required>
                                    <i class="fas fa-eye toggle-password" onclick="togglePassword(this)"></i>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
                                <div class="password-wrapper">
                                    <input type="password" name="new_password" required minlength="8">
                                    <i class="fas fa-eye toggle-password" onclick="togglePassword(this)"></i>
                                </div>
                                <div class="password-strength" id="new-password-strength"></div>
                            </div>
                            
                            <div class="form-group">
                                <label>ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
                                <div class="password-wrapper">
                                    <input type="password" name="confirm_password" required>
                                    <i class="fas fa-eye toggle-password" onclick="togglePassword(this)"></i>
                                </div>
                                <div id="password-match-check"></div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                            </button>
                        </form>
                    </div>

                    <!-- Forgot Password -->
                    <div class="security-card">
                        <h3>ğŸ”‘ Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</h3>
                        <p>Ø¥Ø°Ø§ Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†Ù‡Ø§ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.</p>
                        <a href="{{ url_for('forgot_password') }}" class="btn btn-secondary">
                            <i class="fas fa-envelope"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                        </a>
                    </div>
                </div>
</div>

            <!-- Settings Section -->
            <div id="settings" class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
            </div>

            <div class="settings-content">
                <!-- Notification Settings -->
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>ğŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h4>
                        <p>Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø­ÙˆÙ„ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" checked>
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <h4>ğŸ® Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø·ÙˆØ±</h4>
                        <p>Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ† Ø­ÙˆÙ„ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" {{ 'checked' if user.is_developer() else '' }}>
                        <span class="slider"></span>
                    </label>
                </div>
                
                <!-- Social Media Settings (for developers only) -->
                {% if user.is_developer() %}
                <div class="setting-item social-media-settings">
                    <div class="setting-info">
                        <h4>ğŸŒ ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</h4>
                        <p>Ø£Ø¶Ù Ø±ÙˆØ§Ø¨Ø· Ø­Ø³Ø§Ø¨Ø§ØªÙƒ Ø¹Ù„Ù‰ ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</p>
                    </div>
                </div>
                
                <form class="social-media-form" action="{{ url_for('update_social_media') }}" method="POST">
                    <div class="form-group">
                        <label><i class="fab fa-twitter"></i> Twitter</label>
                        <input type="url" name="twitter" placeholder="https://twitter.com/Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" 
                            value="{{ user_social_media.twitter if user_social_media else '' }}">
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fab fa-linkedin"></i> LinkedIn</label>
                        <input type="url" name="linkedin" placeholder="https://linkedin.com/in/Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" 
                            value="{{ user_social_media.linkedin if user_social_media else '' }}">
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fab fa-github"></i> GitHub</label>
                        <input type="url" name="github" placeholder="https://github.com/Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" 
                            value="{{ user_social_media.github if user_social_media else '' }}">
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-globe"></i> Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙˆÙŠØ¨ Ø§Ù„Ø´Ø®ØµÙŠ</label>
                        <input type="url" name="website" placeholder="https://example.com" 
                            value="{{ user_social_media.website if user_social_media else '' }}">
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Ø­ÙØ¸ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„
                    </button>
                </form>
                {% endif %}
            </div>
        </div>

            <!-- My Games Section (for developers) -->
            <!-- In the My Games section -->
            {% if user.is_developer() %}
            <div id="my-games" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-gamepad"></i> Ø£Ù„Ø¹Ø§Ø¨ÙŠ</h2>
                    <a href="{{ url_for('upload') }}" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©
                    </a>
                </div>
                <div class="games-grid">
                    {% if developer_games %}
                        {% for game in developer_games %}
                        <div class="game-card">
                            <div class="game-thumbnail">
                                <!-- Add onerror handling to images -->
                                <img src="{{ game.thumbnail_url }}" alt="{{ game.title }}" onerror="this.src="{{ url_for('static', filename='images/logo.png') }}">
                            </div>
                            <div class="game-info">
                                <h3>{{ game.title }}</h3>
                                <p class="developer">{{ user.username }}</p>
                                <p class="description">{{ game.short_description }}</p>
                                <div class="game-meta">
                                    <div class="rating">
                                        <i class="fas fa-star"></i> {{ game.rating }}
                                    </div>
                                </div>
                                <div class="game-actions">
                                    <a href="{{ url_for('game_details', game_slug=game.slug) }}" class="btn btn-small">
                                        <i class="fas fa-eye"></i> Ø¹Ø±Ø¶
                                    </a>
                                    <button class="btn btn-small btn-secondary" onclick="editGame('{{ game.id }}')">
                                        <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
                                    </button>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-state">
                            <i class="fas fa-gamepad"></i>
                            <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù„Ø¹Ø§Ø¨ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</h3>
                            <p>Ø§Ø¨Ø¯Ø£ Ø¨Ø±ÙØ¹ Ø£ÙˆÙ„ Ù„Ø¹Ø¨Ø© Ù„Ùƒ ÙˆØ§Ù†Ø´Ø± Ø¥Ø¨Ø¯Ø§Ø¹Ø§ØªÙƒ Ù„Ù„Ù…Ø¬ØªÙ…Ø¹</p>
                            <a href="{{ url_for('upload') }}" class="btn btn-primary">
                                <i class="fas fa-upload"></i> Ø±ÙØ¹ Ø£ÙˆÙ„ Ù„Ø¹Ø¨Ø©
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Password Reset Modal -->
<div id="resetModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>ğŸ“§ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†</h2>
        <p>ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: <strong>{{ user.email }}</strong></p>
        <p> ÙŠØ±Ø¬Ù‰ Ø±Ø¤ÙŠØ© Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„ÙˆØ§Ø±Ø¯ ÙˆÙ…Ø¬Ù„Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ø§Ù„Ù…Ø±ØºÙˆØ¨ ÙÙŠÙ‡Ø§.</p>
        <button class="btn btn-primary" onclick="closeModal()">Ø­Ø³Ù†Ø§Ù‹</button>
    </div>
</div>

<script>

// Form validation
document.getElementById('username-form').addEventListener('submit', function(e) {
    const newUsername = document.getElementById('username-edit').value.trim();
    
    // Client-side validation - ENGLISH ONLY
    if (newUsername.length < 3) {
        e.preventDefault();
        alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
        return;
    }
    
    if (newUsername.length > 20) {
        e.preventDefault();
        alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² 20 Ø­Ø±Ù');
        return;
    }
    
    // English only validation
    if (!/^[a-zA-Z0-9_]+$/.test(newUsername)) {
        e.preventDefault();
        alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø­Ø±Ù Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ£Ø±Ù‚Ø§Ù… ÙˆØ´Ø±Ø·Ø© Ø³ÙÙ„ÙŠØ© (_) ÙÙ‚Ø·');
        return;
    }
});

// Section navigation
function showSection(sectionId) {
    // Hide all sections
    document.querySelectorAll('.content-section').forEach(section => {
        section.classList.remove('active');
    });
    
    // Show selected section
    document.getElementById(sectionId).classList.add('active');
    
    // Update active menu item
    document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('active');
    });
    document.querySelector(`[onclick="showSection('${sectionId}')"]`).classList.add('active');
    
    // Close mobile menu on selection
    if (window.innerWidth <= 768) {
        document.getElementById('accountSidebar').classList.remove('active');
    }
}

function shareResume(devId) {
    const resumeUrl = `{{ url_for('developer_share', dev_id='') }}${devId}`;
    
    if (navigator.share) {
        navigator.share({
            title: 'Ø³ÙŠØ±ØªÙŠ Ø§Ù„Ø°Ø§ØªÙŠØ© - SaudiArcade',
            text: 'ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø£Ø¹Ù…Ø§Ù„ÙŠ ÙƒÙ…Ø·ÙˆØ± Ø£Ù„Ø¹Ø§Ø¨',
            url: resumeUrl
        });
    } else {
        navigator.clipboard.writeText(resumeUrl);
        alert('ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©');
    }
}


// Edit profile
function toggleEdit(section) {
    const form = document.getElementById('username-form');
    const display = document.getElementById('profile-display');
    const usernameDisplay = document.getElementById('username-display');
    const usernameEdit = document.getElementById('username-edit');
    const buttons = document.getElementById('profile-edit-buttons');
    
    if (form.style.display === 'block') {
        // Switch back to display mode
        form.style.display = 'none';
        display.style.display = 'block';
        buttons.style.display = 'none';
        usernameEdit.style.display = 'none';
        usernameDisplay.style.display = 'inline';
    } else {
        // Switch to edit mode
        form.style.display = 'block';
        display.style.display = 'none';
        buttons.style.display = 'flex';
        usernameEdit.style.display = 'block';
        usernameDisplay.style.display = 'none';
        usernameEdit.focus();
    }
}

function cancelEdit(section) {
    // Reset to original username
    const usernameEdit = document.getElementById('username-edit');
    const usernameDisplay = document.getElementById('username-display');
    usernameEdit.value = usernameDisplay.textContent;
    toggleEdit('profile');
}

// Form validation
document.getElementById('username-form').addEventListener('submit', function(e) {
    const newUsername = document.getElementById('username-edit').value.trim();
    
    // Client-side validation
    if (newUsername.length < 3) {
        e.preventDefault();
        alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
        return;
    }
    
    if (newUsername.length > 20) {
        e.preventDefault();
        alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² 20 Ø­Ø±Ù');
        return;
    }
    
    if (!/^[a-zA-Z0-9\u0600-\u06FF]+$/.test(newUsername)) {
        e.preventDefault();
        alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø­Ø±Ù ÙˆØ£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·');
        return;
    }
});
// Password functionality
function togglePassword(fieldId) {
    const input = document.getElementById(fieldId);
    const icon = input.parentElement.querySelector('.toggle-password');
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.replace('fa-eye', 'fa-eye-slash');
    } else {
        input.type = 'password';
        icon.classList.replace('fa-eye-slash', 'fa-eye');
    }
}

function changePassword(event) {
    event.preventDefault();
    const currentPass = document.getElementById('current-password').value;
    const newPass = document.getElementById('new-password').value;
    const confirmPass = document.getElementById('confirm-new-password').value;
    
    if (newPass !== confirmPass) {
        alert('ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©');
        return false;
    }
    
    if (newPass.length < 8) {
        alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
        return false;
    }
    
    alert('ØªÙ… Ø·Ù„Ø¨ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­');
    // Here you would send the request to the server
    return false;
}

function requestPasswordReset(event) {
    event.preventDefault();
    document.getElementById('resetModal').style.display = 'block';
    return false;
}

function closeModal() {
    document.getElementById('resetModal').style.display = 'none';
}

// Mobile menu toggle
function toggleMobileMenu() {
    document.getElementById('accountSidebar').classList.toggle('active');
}

// Close modal if clicked outside
window.onclick = function(event) {
    const modal = document.getElementById('resetModal');
    if (event.target === modal) {
        closeModal();
    }
}

// Password strength check
document.getElementById('new-password').addEventListener('input', function() {
    const password = this.value;
    const strengthDiv = document.getElementById('new-password-strength');
    
    if (password.length === 0) {
        strengthDiv.innerHTML = '';
        return;
    }
    
    let strength = 0;
    if (password.length >= 8) strength++;
    if (/[A-Z]/.test(password)) strength++;
    if (/[0-9]/.test(password)) strength++;
    if (/[^A-Za-z0-9]/.test(password)) strength++;
    
    const strengthText = ['Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹', 'Ø¶Ø¹ÙŠÙØ©', 'Ø¬ÙŠØ¯Ø©', 'Ù‚ÙˆÙŠØ©', 'Ù‚ÙˆÙŠØ© Ø¬Ø¯Ø§Ù‹'];
    const strengthColors = ['#ff4d4d', '#ff6b6b', '#feca57', '#48dbfb', '#1dd1a1'];
    
    strengthDiv.innerHTML = `
        <div style="color: ${strengthColors[strength]}">
            ${strengthText[strength]}
        </div>
    `;
});

// Password match check
document.getElementById('confirm-new-password').addEventListener('input', function() {
    const newPass = document.getElementById('new-password').value;
    const confirmPass = this.value;
    const matchDiv = document.getElementById('password-match-check');
    
    if (confirmPass.length === 0) {
        matchDiv.innerHTML = '';
        return;
    }
    
    if (newPass === confirmPass) {
        matchDiv.innerHTML = '<span style="color: #1dd1a1">âœ“ Ù…ØªØ·Ø§Ø¨Ù‚Ø©</span>';
    } else {
        matchDiv.innerHTML = '<span style="color: #ff6b6b">âœ— ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©</span>';
    }
});
</script>

<style>
/* Responsive Account Styles */
.account-container {
    min-height: 100vh;
    background: #1a1a1a;
    padding: 1rem;
}

.mobile-account-header {
    display: none;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: #2d2d2d;
    border-radius: 12px;
    margin-bottom: 1rem;
}

.mobile-menu-toggle {
    background: none;
    border: none;
    color: #f0f0f0;
    font-size: 1.5rem;
    cursor: pointer;
}

.account-content-wrapper {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 2rem;
    max-width: 1200px;
    margin: 0 auto;
}

.account-profile-card {
    background: #2d2d2d;
    border-radius: 12px;
    padding: 2rem;
    text-align: center;
    margin-bottom: 1rem;
}

.account-avatar {
    position: relative;
    margin: 0 auto 1rem;
    width: 80px;
}

.account-avatar img {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid #2EC630;
}

.online-status {
    position: absolute;
    bottom: 5px;
    right: 5px;
    width: 15px;
    height: 15px;
    border-radius: 50%;
    border: 2px solid #2d2d2d;
}

.online-status.online { background: #2EC630; }
.online-status.offline { background: #8f8f8f; }

.account-type-badge {
    display: inline-block;
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: bold;
    margin: 0.5rem 0;
}

.account-type-badge.developer { background: #2EC630; color: white; }
.account-type-badge.user { background: #3498db; color: white; }

.account-email {
    color: #b0b0b0;
    font-size: 0.9rem;
}

.account-menu {
    background: #2d2d2d;
    border-radius: 12px;
    padding: 1rem;
}

.menu-item {
    display: flex;
    align-items: center;
    padding: 1rem;
    color: #f0f0f0;
    text-decoration: none;
    border-radius: 8px;
    margin: 0.3rem 0;
    transition: background 0.3s;
}

.menu-item:hover,
.menu-item.active {
    background: #3d3d3d;
}

.menu-item i {
    margin-left: 0.8rem;
    width: 20px;
    text-align: center;
}

.logout-btn {
    color: #e74c3c !important;
    border-top: 1px solid #444;
    margin-top: 1rem;
    padding-top: 1rem;
}

.account-main-content {
    background: #2d2d2d;
    border-radius: 12px;
    padding: 2rem;
}

.content-section {
    display: none;
}

.content-section.active {
    display: block;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #444;
}

.profile-info {
    display: grid;
    gap: 1rem;
}

.info-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: #3d3d3d;
    border-radius: 8px;
}

.info-item label {
    font-weight: bold;
    color: #2EC630;
}

.edit-buttons {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
}

.security-card {
    background: #3d3d3d;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
}

.security-form {
    margin-top: 1rem;
}

.setting-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: #3d3d3d;
    border-radius: 8px;
    margin-bottom: 1rem;
}

.setting-info h4 {
    margin: 0 0 0.3rem 0;
    color: #f0f0f0;
}

.setting-info p {
    margin: 0;
    color: #b0b0b0;
    font-size: 0.9rem;
}

/* Switch toggle */
.switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 24px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: #2EC630;
}

input:checked + .slider:before {
    transform: translateX(26px);
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
}

.modal-content {
    background-color: #2d2d2d;
    margin: 15% auto;
    padding: 2rem;
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    text-align: center;
}

.close {
    color: #aaa;
    float: left;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.close:hover {
    color: #f0f0f0;
}

/* Empty state */
.empty-state {
    text-align: center;
    padding: 3rem;
    color: #b0b0b0;
}

.empty-state i {
    font-size: 4rem;
    margin-bottom: 1rem;
    color: #2EC630;
}

/* Responsive Design */
@media (max-width: 968px) {
    .account-content-wrapper {
        grid-template-columns: 250px 1fr;
        gap: 1rem;
    }
}

@media (max-width: 768px) {
    .mobile-account-header {
        display: flex;
    }
    
    .account-content-wrapper {
        grid-template-columns: 1fr;
    }
    
    .account-sidebar {
        position: fixed;
        left: -100%;
        top: 0;
        width: 80%;
        height: 100vh;
        background: #2d2d2d;
        z-index: 1000;
        transition: left 0.3s ease;
        overflow-y: auto;
    }
    
    .account-sidebar.active {
        left: 0;
    }
    
    .account-main-content {
        padding: 1rem;
    }
    
    .info-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }
    
    .section-header {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
    }
}

@media (max-width: 480px) {
    .account-container {
        padding: 0.5rem;
    }
    
    .security-card {
        padding: 1rem;
    }
    
    .setting-item {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
    }
}

/* Buttons */
.btn {
    padding: 0.7rem 1.2rem;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-family: 'Tajawal', sans-serif;
    font-weight: 500;
    transition: all 0.3s;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-primary {
    background: #2EC630;
    color: white;
}

.btn-primary:hover {
    background: #25a328;
    transform: translateY(-2px);
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
}

.btn-edit {
    background: #3498db;
    color: white;
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
}

/* Form styles */
.form-group {
    margin-bottom: 1rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    color: #f0f0f0;
    font-weight: 500;
}

.form-group input {
    width: 100%;
    padding: 0.8rem;
    border: 1px solid #444;
    border-radius: 8px;
    background: #3d3d3d;
    color: #f0f0f0;
    font-family: 'Tajawal', sans-serif;
}

.password-wrapper {
    position: relative;
}

.toggle-password {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    color: #8f8f8f;
}

.edit-field {
    background: #2d2d2d !important;
    border: 2px solid #2EC630 !important;
}

.game-actions {
    display: flex;
    gap: 0.5rem;
    margin-top: 1rem;
}

.btn-small {
    padding: 0.4rem 0.8rem;
    font-size: 0.9rem;
}

.empty-state {
    text-align: center;
    padding: 3rem;
    color: #b0b0b0;
    grid-column: 1 / -1;
}

.empty-state i {
    font-size: 4rem;
    margin-bottom: 1rem;
    color: #2EC630;
}

.empty-state h3 {
    color: #f0f0f0;
    margin-bottom: 0.5rem;
}

.games-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
    margin-top: 1.5rem;
}

.developer-resume-actions {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
    flex-wrap: wrap;
}

.developer-resume-actions .btn {
    padding: 0.8rem 1.5rem;
    font-size: 0.9rem;
}

@media (max-width: 768px) {
    .developer-resume-actions {
        flex-direction: column;
    }
    
    .developer-resume-actions .btn {
        width: 100%;
    }
}

</style>
{% endblock %}